<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:100,200,300,400,500,600,700,800,900" rel="stylesheet">
    
    <title>ì£¼ì‹íˆ¬ìê²Œì„</title>
    
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/templatemo-grad-school.css">
    <link rel="stylesheet" href="assets/css/owl.css">
</head>

<body>

    <!-- í—¤ë” -->
    <header class="main-header clearfix">
        <div class="logo">
            <a><em>ì£¼ì‹íˆ¬ì</em> ê²Œì„</a>
        </div>
        <a href="#menu" class="menu-link"><i class="fa fa-bars"></i></a>
        <nav id="menu" class="main-nav">
            <ul class="main-menu">
                <li><a href="signup">ê³„ì •ì´ ì—†ë‹¤ë©´ ë°”ë¡œ *íšŒì›ê°€ì… !</a></li>
            </ul>
        </nav>
    </header>
    <!-- ë©”ì¸ ë°°ë„ˆ -->
    <section class="section main-banner" id="top" data-section="section1">
        <video autoplay muted loop id="bg-video">
            <source src="assets/images/course-video.mp4" type="video/mp4" />
        </video>

        <div class="video-overlay header-text">
            <div class="container">
                <div class="row">
                    <!-- ì™¼ìª½ ë°°ë„ˆ ì½˜í…ì¸  -->
                    <div class="col-md-7">
                        <div class="caption">
                            <h2><em>ì£¼ì‹íˆ¬ì</em> ê²Œì„</h2>
                            <div class="main-button">
                                <div class="scroll-to-section"><a id="game-start" style="cursor: pointer;">ê²Œì„ ì‹œì‘</a></div>
                            </div>
                        </div>
                    </div>

                    <!-- ì˜¤ë¥¸ìª½ ë¡œê·¸ì¸ í¼ -->
                    <div class="col-md-5">
                        <section class="section coming-soon" data-section="section3">
                            <div class="right-content">
                                <div class="top-content">
                                    <h6>ì§€ê¸ˆ ë‹¹ì¥ ë¡œê·¸ì¸í•˜ì—¬ <em>ì£¼ì‹íˆ¬ì</em> ê²Œì„ì„ ì²´í—˜í•´ë³´ì„¸ìš”.</h6>
                                </div>
                                <form id="login-form" method="get">
                                    <div class="row">
                                        <!-- <div class="col-md-12">
                                            <fieldset>
                                                <input name="name" type="text" class="form-control" id="name" placeholder="ì´ë¦„" required="">
                                            </fieldset>
                                        </div> -->
                                        <div id="div_id" class="col-md-12">
                                            <fieldset>
                                                <input name="ID" type="text" class="form-control" id="ID" placeholder="ì•„ì´ë””" required="">
                                            </fieldset>
                                        </div>
                                        <div id="div_pwd" class="col-md-12">
                                            <fieldset>
                                                <input name="password" type="password" class="form-control" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸" required="">
                                            </fieldset>
                                        </div>
                                        <div class="col-md-12">
                                            <fieldset>
                                                <button type="submit" id="form-submit" class="button">ë¡œê·¸ì¸</button>
                                            </fieldset>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </section>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ëª…ì˜ˆì˜ ì „ë‹¹ -->
    <section class="section courses" data-section="section4"> 
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-12">
            <div class="section-heading">
              <h2>ëª…ì˜ˆì˜ ì „ë‹¹</h2>
            </div>
          </div>
          <div class="owl-carousel owl-theme">
            <div class="item1">
              <div class="down-content">
                <h4>1ë“±</h4>
              </div>
            </div>
            <div class="item2">
              <div class="down-content">
                <h4>2ë“±</h4>
              </div>
            </div>
            <div class="item3">
              <div class="down-content">
                <h4>3ë“±</h4>
              </div>
            </div>
            <div class="item4">
              <div class="down-content">
                <h4>4ë“±</h4>
              </div>
            </div>
            <div class="item5">
              <div class="down-content">
                <h4>5ë“±</h4>
              </div>
            </div>
            <div class="item6">
              <div class="down-content">
                <h4>6ë“±</h4>
              </div>
            </div>
            <div class="item7">
              <div class="down-content">
                <h4>7ë“±</h4>
              </div>
            </div>
            <div class="item8">
              <div class="down-content">
                <h4>8ë“±</h4>
              </div>
            </div>
            <div class="item9">
              <div class="down-content">
                <h4>9ë“±</h4>
              </div>
            </div>
            <div class="item10">
              <div class="down-content">
                <h4>10ë“±</h4>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- í‘¸í„° -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <p><i class="fa fa-copyright"></i> PROJECT BY 7 GROUP | 2025 BACK-END BOOTCAMP</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/owl-carousel.js"></script>
    <script src="assets/js/video.js"></script>
    <script src="assets/js/slick-slider.js"></script>
    <script src="assets/js/custom.js"></script>
    <script>
      document.getElementById("game-start").addEventListener("click", async function(event) {
        const token = localStorage.getItem("token");
        if (token) {
          const response = await fetch("http://127.0.0.1:8000/auth/check-token", {  // FastAPI ë¡œê·¸ì•„ì›ƒ ì—”ë“œí¬ì¸íŠ¸
              method: "POST",
              headers: {
                  "Authorization": `Bearer ${token}`
              }
          });
          if (response.ok) {
            window.location.href = "/front2/index";
          } else{
            alert("í† í° ê²€ì¦ ì‹¤íŒ¨! ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");
          } 
        }
        else {
          alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
        }
      });

      document.getElementById("login-form").addEventListener("submit", async function (event) {
        event.preventDefault();  // ê¸°ë³¸ í¼ ì œì¶œ ë§‰ê¸°
        const loginButton = document.getElementById("form-submit")
        if (loginButton.innerHTML === "ë¡œê·¸ì¸") {
          const login_id = document.getElementById("ID").value;
          const pwd = document.getElementById("password").value;
          const response = await fetch("http://127.0.0.1:8000/auth/login", {  // FastAPI ë¡œê·¸ì¸ ì—”ë“œí¬ì¸íŠ¸
              method: "POST",
              headers: {
                  "Content-Type": "application/json"
              },
              body: JSON.stringify({ login_id, pwd })  // FastAPIì— JSONìœ¼ë¡œ ë°ì´í„° ì „ì†¡
          });

          const result = await response.json();

          if (response.ok) {
              alert("ë¡œê·¸ì¸ ì„±ê³µ!");
              localStorage.setItem("token", result.access_token);  // JWT í† í° ì €ì¥

              document.querySelector(".top-content").innerHTML = `<h6>${login_id}ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!</h6>`;
              document.querySelector("#div_id").style.display = "none";
              document.querySelector("#div_pwd").style.display = "none";
              document.querySelector("#form-submit").innerHTML = `ë¡œê·¸ì•„ì›ƒ`;
          } else {
              alert("ë¡œê·¸ì¸ ì‹¤íŒ¨: " + result.detail);
          }
        }

        else if (loginButton.innerHTML === "ë¡œê·¸ì•„ì›ƒ") {
          const token = localStorage.getItem("token");

          if (token) {
              const response = await fetch("http://127.0.0.1:8000/auth/logout", {  // FastAPI ë¡œê·¸ì•„ì›ƒ ì—”ë“œí¬ì¸íŠ¸
                  method: "POST",
                  headers: {
                      "Authorization": `Bearer ${token}`
                  }
              });
              
              const data = await response.json();
              alert(data.message);  // "ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤."
              
              // ë¡œê·¸ì•„ì›ƒ í›„ í† í° ì‚­ì œ
              localStorage.removeItem("token");

              document.getElementById("ID").value = "";  // ID ë¹„ìš°ê¸°
              document.getElementById("password").value = "";  // ë¹„ë°€ë²ˆí˜¸ ë¹„ìš°ê¸°

              // ë¡œê·¸ì•„ì›ƒ í›„ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
              document.querySelector("#form-submit").innerHTML = `ë¡œê·¸ì¸`;  // ë¡œê·¸ì¸ ë²„íŠ¼ìœ¼ë¡œ ëŒì•„ê°€ê¸°
              document.querySelector(".top-content").innerHTML = `<h6>ì§€ê¸ˆ ë‹¹ì¥ ë¡œê·¸ì¸í•˜ì—¬ ì£¼ì‹íˆ¬ì ê²Œì„ì„ ì²´í—˜í•´ë³´ì„¸ìš”.</h6>`;
              document.querySelector("#div_id").style.display = "block";
              document.querySelector("#div_pwd").style.display = "block";
          } else {
              alert("ë¡œê·¸ì¸ ìƒíƒœê°€ ì•„ë‹™ë‹ˆë‹¤.");
          }
      };
    });

    
    window.onload = function() {
      fetch('/record')
        .then(response => response.json())
        .then(data => {
          // ëª…ì˜ˆì˜ì „ë‹¹ ë°ì´í„° ì—…ë¡œë“œ
          for (let i = 0; i < data["rankings"].length; i++) {
            document.querySelector(`.item${i+1} .down-content h4`).innerHTML = `${i+1}ë“± : ${data["rankings"][i].login_id} <br> ${data["rankings"][i].balance}ì›`;
          }
        })
      // ğŸ“Œ 10ì´ˆë§ˆë‹¤ ìë™ ì‹¤í–‰ (10000ms = 10ì´ˆ)
      setInterval(updateRankings, 5000);

      document.addEventListener("scroll", function () {
        updateRankings();
      });
      // ì²«í™”ë©´ ë“¤ì–´ê°€ì ë§ì ëª…ì˜ˆì˜ì „ë‹¹ ì—…ë°ì´íŠ¸ í•´ì£¼ê¸°ê¸°
      updateRankings();
    };

    function updateRankings() {
      fetch('/record') // ìµœì‹  ë°ì´í„°ë¥¼ ë‹¤ì‹œ ê°€ì ¸ì˜´
        .then(response => response.json()) 
        .then(data => {
          for (let i = 0; i < data["rankings"].length; i++) {
            document.querySelector(`.item${i+1} .down-content h4`).innerHTML = 
              `${i+1}ë“± : ${data["rankings"][i].login_id} <br> ${data["rankings"][i].balance}ì›`;
          }
        })
        .catch(error => console.error("âŒ ëª…ì˜ˆì˜ ì „ë‹¹ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:", error));
    }

    </script>
    
</body>
</html>